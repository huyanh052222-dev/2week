<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Cloud</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Pacifico&family=Inter:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="style.css">
    <script src="main.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
    --purple-bg: #8c7ae6; 
    --dark-purple-sidebar: #523f9b; 
    --cover-purple: #523f9b; 
    --paper-color: #f7f3e8; 
    --red-block: #b36363; 
    --blue-block: #749fa3; 
    --text-color: #2c2c2c;
    --handwriting-font: 'Pacifico', cursive; 
    --main-font: 'Inter', sans-serif; 
    --shadow-soft: 0 10px 40px rgba(0, 0, 0, 0.2); 
}

body {
    margin: 0;
    font-family: var(--main-font);
    background: var(--purple-bg);
    display: flex;
    height: 100vh;
    overflow: hidden;
    color: var(--text-color);
}

.container-sidebar {
    width: 250px; 
    background: var(--dark-purple-sidebar);
    color: white;
    display: flex;
    flex-direction: column;
    padding: 20px 0;
    box-shadow: 5px 0 15px rgba(0, 0, 0, 0.3);
    z-index: 100;
}
.side-bar {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: 0 20px;
}
.sidebar-header {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 24px;
    font-weight: 700;
    padding-bottom: 20px;
    margin-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    flex-wrap: wrap;
}
.eirlys-logo {
    font-family: var(--handwriting-font);
    font-size: 32px;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    color: var(--dark-purple-sidebar);
    font-weight: 400;
}
.link-integrations {
    width: 100%;
    font-size: 14px;
    font-weight: 400;
    opacity: 0.7;
    margin-top: 5px;
    margin-left: 50px;
}
.main-menu {
    flex-grow: 1; 
}
.bottom-menu {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 20px;
}
.side-bar a {
    color: white;
    text-decoration: none;
    padding: 12px 15px;
    margin: 4px 0;
    display: flex; 
    align-items: center;
    gap: 10px;
    border-radius: 8px;
    transition: background 0.2s, transform 0.2s;
    font-weight: 500;
}
.side-bar a i {
    width: 20px;
    text-align: center;
}
.side-bar a.active-nav {
    background: rgba(255, 255, 255, 0.15);
    font-weight: 600;
}
.side-bar a:hover {
    background: rgba(255, 255, 255, 0.1);
}

.container-wrap-content {
    flex: 1;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
}

.book {
    width: 900px; 
    height: 90vh; 
    max-height: 850px; 
    perspective: 2500px;
    position: relative;
    display: flex;
    justify-content: flex-start; 
    align-items: center;
    gap: 0px; 
}

.paper {
    width: 450px; 
    height: 100%;
    position: absolute;
    transform-origin: left;
    transform-style: preserve-3d;
    transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94), z-index 0.5s;
    border-radius: 12px; 
    box-shadow: var(--shadow-soft); 
}

.flipped {
    transform: rotateY(-180deg);
}

.front,
.back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    padding: 30px;
    box-sizing: border-box;
    overflow: hidden; 
    border-radius: 12px;
    background: var(--paper-color); 
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
}

.back {
    transform: rotateY(180deg);
    background: var(--paper-color);
}
.book-cover {
    background: var(--cover-purple); 
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 28px;
    text-align: center;
    user-select: none;
    gap: 30px;
}
.cover-title-main {
    font-family: var(--handwriting-font);
    font-size: 60px; 
    margin-bottom: -10px;
}
.cover-title-sub {
    font-size: 20px;
    font-weight: 400;
}
.cover-image-placeholder {
    width: 180px;
    height: 120px;
    background: white;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--handwriting-font);
    font-size: 32px;
    color: var(--text-color);
}
.cover-start-btn {
    padding: 12px 30px;
    background: white;
    color: var(--cover-purple);
    border: none;
    border-radius: 25px;
    font-weight: 600;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s;
}
.cover-start-btn:hover {
    transform: translateY(-2px);
}
.layout-container {
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: 15px;
}
.layout-front-1 .block-top {height: 15%; background: var(--red-block); border-radius: 8px;}
.layout-front-1 .block-main {height: 80%; background: var(--red-block); border-radius: 8px;}
.layout-back-1 {display: grid; grid-template-rows: 40% 55%; gap: 15px;}
.layout-back-1 .block-top-group {display: grid; grid-template-columns: 40% 55%; gap: 15px;}
.layout-back-1 .block-top-group .block-left {background: var(--red-block); border-radius: 8px;}
.layout-back-1 .block-top-group .block-right {background: var(--blue-block); border-radius: 8px;}
.layout-back-1 .block-bottom {background: var(--red-block); border-radius: 8px;}
.layout-front-2 {display: grid; grid-template-rows: 15% 30% 25% 20%; gap: 15px;}
.layout-front-2 .block-top {background: var(--red-block); border-radius: 8px;}
.layout-front-2 .block-mid-group {display: grid; grid-template-columns: 40% 55%; gap: 15px;}
.layout-front-2 .block-mid-group .block-mid-left {background: var(--blue-block); border-radius: 8px;}
.layout-front-2 .block-mid-group .block-mid-right {background: var(--red-block); border-radius: 8px;}
.layout-front-2 .block-large-mid {background: var(--red-block); border-radius: 8px;}
.layout-front-2 .block-bottom {background: var(--blue-block); border-radius: 8px;}
.layout-back-2 {display: grid; grid-template-rows: 40% 55%; gap: 15px;}
.layout-back-2 .block-top-group {display: grid; grid-template-columns: 40% 55%; gap: 15px;}
.layout-back-2 .block-top-group .block-left {background: var(--red-block); border-radius: 8px;}
.layout-back-2 .block-top-group .block-right {background: var(--blue-block); border-radius: 8px;}
.layout-back-2 .block-bottom {background: var(--red-block); border-radius: 8px;}
.footer-dots {
    position: absolute;
    bottom: 10px;
    left: 0;
    right: 0;
    display: flex;
    justify-content: center;
    gap: 5px;
}
.dot {width: 8px; height: 8px; background: #ccc; border-radius: 50%;}
.dot.active {background: #777;}


#prev-page-btn,
#next-page-btn {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 40px;
    height: 40px;
    font-size: 24px;
    padding: 0;
    cursor: pointer;
    border: none;
    border-radius: 50%;
    background: #fff; 
    color: var(--text-color);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
}

.nav-btn.left-btn {
    left: calc(250px + 50px); 
} 
.nav-btn.right-btn {
    right: 50px; 
}

#prev-page-btn:hover,
#next-page-btn:hover {background: #eee;}


#toggle-toolbar-menu { 
    position: fixed; 
    top: 20px;
    right: 20px;
    font-size: 24px;
    cursor: pointer;
    z-index: 2000;
    width: 40px;
    height: 40px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}

#floating-menu {
    position: fixed;
    top: 70px; 
    right: 20px;
    width: 250px;
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    z-index: 1999;
    display: none; 
    flex-direction: column;
    gap: 15px;
    font-size: 16px;
}

#floating-menu.show {
    display: flex;
}
.menu-group {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}
.menu-group:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.menu-group.style-buttons button {
    width: 30px;
    height: 30px;
    font-size: 18px;
    font-weight: 700;
    background: #f0f0f0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

.menu-group.select-row {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 10px;
}

.menu-group select {
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-family: var(--main-font);
}

.menu-group.color-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
}
.menu-group input[type="color"] {
    width: 40px;
    height: 30px;
    padding: 0;
    border: 1px solid #ccc;
    border-radius: 4px;
}

.menu-group.align-buttons button {
    flex: 1;
    background: #f0f0f0;
    border: none;
    padding: 8px 0;
    border-radius: 4px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
}

.menu-group.align-buttons button.active-align {
    background: #007bff;
    color: white;
}

.menu-group.action-buttons {
    flex-direction: column;
    gap: 5px;
}
.menu-group.action-buttons button {
    background: #e9ecef;
    border: none;
    padding: 10px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    text-align: left;
    display: flex;
    align-items: center;
    gap: 10px;
}
.menu-group.action-buttons .add-page-button {
    background: var(--purple-bg);
    color: white;
}

/* Th√™m styling cho ·∫£nh ƒë∆∞·ª£c ch√®n (t√πy ch·ªçn) */
.paper img {
    max-width: 100%;
    height: auto;
    border-radius: 6px;
    margin: 10px 0;
}
    </style>
</head>
<body>
    <div class="container-sidebar">
        <div class="side-bar">
            <div class="sidebar-header">
                <div class="eirlys-logo">Eirlys</div>
                NoteCloud
                <div class="link-integrations">Link Integrations ü¶äüî•</div>
            </div>
            
            <div class="main-menu">
                <a href="index.html" class="side-item active-nav" title="Trang Ch·ªß">
                    <i class="fas fa-home"></i> Trang Ch·ªß
                </a>
                <a href="#" class="side-item" title="ƒê√°nh Gi√°">
                    <i class="fas fa-file-invoice"></i> ƒê√°nh gi√°
                </a>
                <a href="#" class="side-item" title="C·∫•u chuy·ªán">
                    <i class="fas fa-book"></i> C√¢u chuy·ªán
                </a>
                <a href="#" class="side-item" id="add-page-sidebar-btn" title="Th√™m trang">
                    <i class="fas fa-plus"></i> Th√™m trang 
                </a>
            </div>

            <div class="bottom-menu">
                <a href="#" class="side-item" title="C√¥ng c·ª•">
                    <i class="fas fa-tools"></i> C√¥ng c·ª•
                </a>
                <a href="#" class="side-item" title="Tr·ª£ gi√∫p">
                    <i class="fas fa-question-circle"></i> Tr·ª£ gi√∫p
                </a>
            </div>
        </div>
    </div>

<div class="container-wrap-content">
    <button id="prev-page-btn" class="nav-btn left-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <div class="book" id="book"></div>
    <button id="next-page-btn" class="nav-btn right-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18l6-6-6-6"/></svg>
    </button>
</div>

<button id="toggle-toolbar-menu">
    <i class="fas fa-bars"></i>
</button>

<div id="floating-menu">
    <div class="menu-group style-buttons">
        <button data-cmd="bold">B</button>
        <button data-cmd="italic">I</button>
        <button data-cmd="underline">U</button>
    </div>
    
    <div class="menu-group select-row">
        <select id="font-family">
            <option value="Inter, sans-serif">Inter</option>
            <option value="Nunito, sans-serif">Nunito</option>
            <option value="Arial, sans-serif">Arial</option>
            <option value="Pacifico, cursive">Handwriting</option>
        </select>
        <select id="font-size">
            <option value="16px">Normal</option>
            <option value="14px">Small</option>
            <option value="18px">Medium</option>
            <option value="24px">Large</option>
        </select>
    </div>
    
    <div class="menu-group color-row">
        <label for="color">M√†u ch·ªØ:</label>
        <input type="color" id="color" value="#2c2c2c">
    </div>

    <div class="menu-group align-buttons">
        <button data-cmd="justifyLeft" class="align-btn active-align">CƒÉn Tr√°i</button>
        <button data-cmd="justifyCenter" class="align-btn">CƒÉn Gi·ªØa</button>
        <button data-cmd="justifyRight" class="align-btn">CƒÉn Ph·∫£i</button>
    </div>

    <div class="menu-group action-buttons">
        <button id="insert-image-btn" class="action-btn link-button">
            <i class="fas fa-image"></i> Th√™m ·∫£nh
        </button>
        <input type="file" id="image-upload-input" accept="image/*" style="display: none;">
        
        <button data-cmd="createLink" class="action-btn link-button">üîó Th√™m Li√™n k·∫øt</button>
        <button id="add-page-panel-btn" class="action-btn add-page-button">‚ûï Th√™m trang m·ªõi</button>
    </div>
</div>

<audio id="bgMusic" loop autoplay>
    <source src="c√≥ h·∫πn v·ªõi thanh xu√¢n - MONSTAR _ official music video.mp3" type="audio/mpeg">
</audio>
<script>
    const book = document.getElementById('book');
const prevBtn = document.getElementById('prev-page-btn');
const nextBtn = document.getElementById('next-page-btn');
const addPageSidebarBtn = document.getElementById('add-page-sidebar-btn');

const floatingMenu = document.getElementById('floating-menu');
const toggleToolbarMenu = document.getElementById('toggle-toolbar-menu');
const addPagePanelBtn = document.getElementById('add-page-panel-btn');

const insertImageBtn = document.getElementById('insert-image-btn');
const imageUploadInput = document.getElementById('image-upload-input');

let pages = [], currentPage = 0;
let savedRange = null;

const Layouts = {
    COVER: `
        <div class="front book-cover">
            <div class="cover-title-main">Eirlys</div>
            <div class="cover-title-sub">N∆°i l∆∞u gi·ªØ k·ªâ ni·ªám</div>
            <div class="cover-image-placeholder">·∫¢nh</div>
            <button class="cover-start-btn" id="start-btn">B·∫Øt ƒë·∫ßu</button>
        </div>
        <div class="back"></div>
    `,
    
    PAGE_1_LAYOUT: `
        <div class="front layout-container layout-front-1">
            <div class="block-top"></div>
            <div class="block-main">Frame 41</div>
            <div class="footer-dots"><div class="dot active"></div><div class="dot"></div></div>
        </div>
        <div class="back layout-container layout-back-1">
            <div class="block-top-group">
                <div class="block-left"></div>
                <div class="block-right"></div>
            </div>
            <div class="block-bottom"></div>
            <div class="footer-dots"><div class="dot"></div><div class="dot active"></div></div>
        </div>
    `,

    PAGE_2_LAYOUT: `
        <div class="front layout-container layout-front-2">
            <div class="block-top"></div>
            <div class="block-mid-group">
                <div class="block-mid-left"></div>
                <div class="block-mid-right"></div>
            </div>
            <div class="block-large-mid"></div>
            <div class="block-bottom"></div>
            <div class="footer-dots"><div class="dot active"></div><div class="dot"></div></div>
        </div>
        <div class="back layout-container layout-back-2">
            <div class="block-top-group">
                <div class="block-left"></div>
                <div class="block-right"></div>
            </div>
            <div class="block-bottom">Frame 41</div>
            <div class="footer-dots"><div class="dot"></div><div class="dot active"></div></div>
        </div>
    `,
    
    PAGE_BLANK: `
        <div class="front"></div>
        <div class="back"></div>
    `
};


function createPage(contentTemplate, isEditable = true) {
    const page = document.createElement('div');
    page.className = 'paper';
    page.innerHTML = contentTemplate;
    page.style.zIndex = 100 - pages.length;
    book.appendChild(page);
    pages.push(page);
    
    if (isEditable) {
        page.querySelectorAll('.front, .back').forEach(el => {
            el.setAttribute('contenteditable', 'true');
            el.addEventListener('mouseup', saveSelection);
            el.addEventListener('keyup', saveSelection);
        });
    }
    return page;
}

function saveSelection() {
    const selection = window.getSelection();
    if (selection.rangeCount > 0) {
        const range = selection.getRangeAt(0);
        const container = range.commonAncestorContainer.closest('[contenteditable="true"]');
        if (container) {
            savedRange = range;
        }
    }
}

function restoreSelection() {
    if (savedRange) {
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(savedRange);
    }
}

function addNewPage() {
    const lastPage = pages.pop();
    if (lastPage) {
        book.removeChild(lastPage);
    }
    
    createPage(Layouts.PAGE_BLANK, true);

    createPage(Layouts.PAGE_BLANK, false); 
    
    currentPage = pages.length - 2; 
    updatePages();
}

function updatePages() {
    pages.forEach((p, i) => {
        if (i < currentPage) {
            p.classList.add('flipped');
            p.style.zIndex = i; 
        } else {
            p.classList.remove('flipped');
            p.style.zIndex = pages.length - i; 
        }
    });

    prevBtn.disabled = currentPage === 0;
    nextBtn.disabled = currentPage === pages.length - 1;
}

prevBtn.addEventListener('click', () => {
    if (currentPage > 0) currentPage--;
    updatePages();
});

nextBtn.addEventListener('click', () => {
    if (currentPage < pages.length - 1) currentPage++;
    updatePages();
});

addPageSidebarBtn.addEventListener('click', (e) => {
    e.preventDefault();
    addNewPage();
});

function initBook() {
    book.innerHTML = '';
    pages = [];
    currentPage = 0;

    createPage(Layouts.COVER, false);
    
    createPage(Layouts.PAGE_1_LAYOUT, true);

    createPage(Layouts.PAGE_2_LAYOUT, true);

    createPage(Layouts.PAGE_BLANK, false);

    updatePages();
    
    const startBtn = document.getElementById('start-btn');
    if (startBtn) {
        startBtn.addEventListener('click', () => {
            currentPage = 1; 
            updatePages();
        });
    }
}

toggleToolbarMenu.addEventListener('click', () => {
    floatingMenu.classList.toggle('show');
});

addPagePanelBtn.addEventListener('click', addNewPage);

floatingMenu.querySelectorAll('button[data-cmd]').forEach(btn => {
    btn.addEventListener('click', () => {
        restoreSelection();
        const cmd = btn.dataset.cmd;
        if (cmd === 'createLink') {
            const url = prompt("Nh·∫≠p URL:");
            if (url) document.execCommand(cmd, false, url);
        } else if (cmd.startsWith('justify')) {
            floatingMenu.querySelectorAll('.align-buttons .align-btn').forEach(b => b.classList.remove('active-align'));
            btn.classList.add('active-align');
            document.execCommand(cmd, false, null);
        } else {
            document.execCommand(cmd, false, null);
        }
    });
});

document.getElementById('font-family').addEventListener('change', e => {
    restoreSelection();
    document.execCommand('fontName', false, e.target.value);
});

document.getElementById('font-size').addEventListener('change', e => {
    restoreSelection();
    let sizeValue = '4';
    switch(e.target.value) {
        case '14px': sizeValue = '3'; break; 
        case '18px': sizeValue = '5'; break; 
        case '24px': sizeValue = '6'; break; 
    }
    document.execCommand('fontSize', false, sizeValue);
});

document.getElementById('color').addEventListener('change', e => {
    restoreSelection();
    document.execCommand('foreColor', false, e.target.value);
});


// --- Logic Th√™m ·∫¢nh M·ªöI ---
insertImageBtn.addEventListener('click', () => {
    imageUploadInput.click();
});

imageUploadInput.addEventListener('change', function(event) {
    if (event.target.files && event.target.files[0]) {
        const file = event.target.files[0];
        const reader = new FileReader();

        reader.onload = function(e) {
            restoreSelection(); 
            if (savedRange) {
                const img = document.createElement('img');
                img.src = e.target.result;
                img.alt = 'Uploaded Image';
                
                // Ch√®n ·∫£nh v√†o v·ªã tr√≠ con tr·ªè
                savedRange.deleteContents();
                savedRange.insertNode(img);
                
                // ƒê·∫∑t l·∫°i con tr·ªè sau ·∫£nh
                savedRange.setEndAfter(img);
                savedRange.collapse(false);
                
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(savedRange);

                // Th√™m d√≤ng m·ªõi sau ·∫£nh ƒë·ªÉ d·ªÖ so·∫°n th·∫£o ti·∫øp
                document.execCommand('insertHTML', false, '<br><br>');

            } else {
                alert('Vui l√≤ng click v√†o v·ªã tr√≠ b·∫°n mu·ªën ch√®n ·∫£nh tr∆∞·ªõc khi nh·∫•n n√∫t "Th√™m ·∫£nh".');
            }
        };

        reader.readAsDataURL(file);
    }
    // X√≥a gi√° tr·ªã input ƒë·ªÉ c√≥ th·ªÉ t·∫£i c√πng 1 file ·∫£nh nhi·ªÅu l·∫ßn
    event.target.value = ''; 
});

initBook();
</script>
</body>
</html>